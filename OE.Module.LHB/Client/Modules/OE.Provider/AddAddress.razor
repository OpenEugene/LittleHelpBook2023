@using OE.Module.LHB.Services

@namespace OE.Provider
@inherits ModuleBase
@inject AddressService AddressService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<Index> Localizer

<Address Addr="@addr"></Address>
<MudButton Color="Color.Primary" OnClick="@(()=> AddAddr())">@Localizer["Save"]</MudButton>
<MudButton Color="Color.Secondary" OnClick="@(()=> Back())">@Localizer["Cancel"]</MudButton>


@code {
    MudForm form;

    public override string Actions => "AddAddress";
    public override bool UseAdminContainer => true;  //popup
    public override string Title => "Manage Address";
    private int _id;
    private readonly M.Address addr = new();
    
    protected override async Task OnInitializedAsync()
    {
        _id = int.Parse(PageState.QueryString["id"]);
    }

    private void Back()
    {
        var url = EditUrl("Detail", $"id={_id}");
        NavigationManager.NavigateTo(url);
    }

    private async Task AddAddr()
    {
        addr.ProviderId = _id;  // this is great!!!
        var returnAddy = await AddressService.AddAddressAsync(addr);
        
        var url = EditUrl("Detail", $"id={_id}");
        NavigationManager.NavigateTo(url);
    }
}
